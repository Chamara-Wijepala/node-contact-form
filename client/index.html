<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Form</title>
</head>

<body>
  <form action="http://localhost:3000/" method="post">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name">
    <ul id="name-error"></ul>

    <label for="email">Email:</label>
    <input type="text" id="email" name="email">
    <ul id="email-error"></ul>

    <label for="message">Message:</label>
    <textarea id="message" name="message"></textarea>
    <ul id="message-error"></ul>

    <button type="submit">Submit</button>
    <p id="form-feedback"></p>
  </form>
</body>


<script>
  const form = document.querySelector('form')

  form.addEventListener('submit', async (e) => {
    // Prevent default behavior, which causes a page reload. This also stops the
    // form from submitting.
    e.preventDefault()

    const formData = new FormData(form)

    try {
      // Submit form data manually
      const response = await fetch(form.action, {
        method: form.method,
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams(formData)
      })

      if (!response.ok) {
        const result = await response.json();

        // Remove any previous errors
        document.getElementById('name-error').innerHTML = '';
        document.getElementById('email-error').innerHTML = '';
        document.getElementById('message-error').innerHTML = '';

        result.errors.forEach(error => {
          const errorElement = document.getElementById(`${error.path}-error`)

          // Create and append an error message to it's respective field
          if (errorElement) {
            const errorMessage = document.createElement('li')
            errorMessage.innerText = error.msg

            errorElement.appendChild(errorMessage)
          }
        })
      } else {
        document.getElementById('form-feedback').innerText = 'Success!';
        form.reset()
      }
    } catch (error) {
      console.log(error)
    }
  })
</script>

</html>